import{_ as i,c as a,o as t,ag as n}from"./chunks/framework.S-Qvb3wi.js";const E=JSON.parse('{"title":"üöÄ Multi-Deployments","description":"","frontmatter":{},"headers":[],"relativePath":"api/multi-deployments/index.md","filePath":"api/multi-deployments/index.md","lastUpdated":null}'),e={name:"api/multi-deployments/index.md"};function l(p,s,h,r,k,o){return t(),a("div",null,s[0]||(s[0]=[n(`<p><a href="./../packages.html">@stephansama actions</a> / multi-deployments</p><h1 id="üöÄ-multi-deployments" tabindex="-1"><strong>üöÄ Multi-Deployments</strong> <a class="header-anchor" href="#üöÄ-multi-deployments" aria-label="Permalink to &quot;**üöÄ Multi-Deployments**&quot;">‚Äã</a></h1><p><a href="https://github.com/stephansama/actions/actions/workflows/test-multi-deployments.yml" target="_blank" rel="noreferrer"><img src="https://github.com/stephansama/actions/actions/workflows/test-multi-deployments.yml/badge.svg" alt="üß™ Test multi deployments"></a></p><p>This GitHub Action simplifies the process of creating multiple GitHub Deployments within a single workflow run. It&#39;s particularly useful for scenarios where you need to deploy to various environments (e.g., staging, preview, production) or different regions simultaneously and track their statuses directly within GitHub.</p><h2 id="‚ú®-features" tabindex="-1"><strong>‚ú® Features</strong> <a class="header-anchor" href="#‚ú®-features" aria-label="Permalink to &quot;**‚ú® Features**&quot;">‚Äã</a></h2><ul><li><strong>Batch Deployment Creation</strong>: Create multiple deployments with a single action call.</li><li><strong>Environment Tracking</strong>: Clearly define and track deployments for different environments.</li><li><strong>Previous Deployment Invalidation</strong>: Optionally invalidate previous deployments for a cleaner deployment history.</li><li><strong>Customizable References</strong>: Specify the commit reference for deployments, or let the action automatically use GitHub CI environment variables.</li></ul><h2 id="üöÄ-usage" tabindex="-1"><strong>üöÄ Usage</strong> <a class="header-anchor" href="#üöÄ-usage" aria-label="Permalink to &quot;**üöÄ Usage**&quot;">‚Äã</a></h2><p>Add the multi-deployments action to your workflow. You&#39;ll need to provide a JSON object specifying the environments and their corresponding URLs.</p><h3 id="example-workflow" tabindex="-1"><strong>Example Workflow</strong> <a class="header-anchor" href="#example-workflow" aria-label="Permalink to &quot;**Example Workflow**&quot;">‚Äã</a></h3><p>This example demonstrates how to use the multi-deployments action to create preview deployments for multiple URLs.</p><p><a href="../_media/example-multi-deployments.yml">example-multi-deployments.yml</a></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">multi-deployments example</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  workflow_dispatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">permissions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  actions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">read</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  contents</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">write</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  deployments</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">write</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  id-token</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">write</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  issues</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">write</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  pull-requests</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">write</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  statuses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">write</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">jobs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  example</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    runs-on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ubuntu-latest</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    steps</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">actions/checkout@v4</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pnpm/action-setup@v4</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">actions/setup-node@v4</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          cache</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;pnpm&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          node-version-file</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;.nvmrc&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Installing dependencies</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pnpm install</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Build all actions</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pnpm run build</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">This is where you create your environments</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">node ./scripts/generate-multi-urls.js</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">generate</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">stephansama/actions/multi-deployments@v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          GITHUB_TOKEN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\${{secrets.GITHUB_TOKEN}}</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          invalidate_previous</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          environments</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\${{steps.generate.outputs.environments}}</span></span></code></pre></div><h3 id="‚öôÔ∏è-inputs" tabindex="-1">‚öôÔ∏è Inputs <a class="header-anchor" href="#‚öôÔ∏è-inputs" aria-label="Permalink to &quot;‚öôÔ∏è Inputs&quot;">‚Äã</a></h3><table tabindex="0"><thead><tr><th>Name</th><th>Default</th><th>Description</th><th>Required</th></tr></thead><tbody><tr><td>environments</td><td>undefined</td><td>Environments to deploy</td><td>true</td></tr><tr><td>invalidate_previous</td><td>false</td><td>Invalidate previous deploys</td><td>false</td></tr><tr><td>ref</td><td><code>\${{github.ref}}</code></td><td>Commit ref to reference for deploys (automatically uses Github CI environments)</td><td>false</td></tr><tr><td>token</td><td><code>\${{github.token}}</code></td><td>GitHub token used to create octokit client</td><td>true</td></tr></tbody></table><h3 id="example-environments-json" tabindex="-1"><strong>Example environments JSON</strong> <a class="header-anchor" href="#example-environments-json" aria-label="Permalink to &quot;**Example environments JSON**&quot;">‚Äã</a></h3><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;my-staging-env&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;https://staging.example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;my-preview-env&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;https://preview.example.com/pr-123&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;production-east&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;https://prod-east.example.com&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="üí°-how-it-works" tabindex="-1"><strong>üí° How It Works</strong> <a class="header-anchor" href="#üí°-how-it-works" aria-label="Permalink to &quot;**üí° How It Works**&quot;">‚Äã</a></h2><p>The action leverages the GitHub Deployments API to create and manage deployment records. For each environment provided in the environments input, it performs the following steps:</p><ol><li><strong>Creates a Deployment</strong>: Initiates a new deployment record for the specified environment and commit reference.</li><li><strong>Sets Deployment Status to &quot;in_progress&quot;</strong>: Immediately updates the deployment status to indicate that the deployment process has started.</li><li><strong>Sets Deployment Status to &quot;success&quot;</strong>: Once all deployments are created, it updates their statuses to &quot;success,&quot; including the environment_url (the URL you provided) and a log_url pointing back to the GitHub Actions workflow run for traceability.</li></ol><p>The invalidate_previous input, when set to true, tells the action to mark any existing deployments for the given environments as inactive before creating the new ones, ensuring only the latest deployments are active.</p><h3 id="inspired-by" tabindex="-1">Inspired by <a class="header-anchor" href="#inspired-by" aria-label="Permalink to &quot;Inspired by&quot;">‚Äã</a></h3><ul><li><a href="https://github.com/bobheadxi/deployments" target="_blank" rel="noreferrer">bobheadxi/deployments</a></li><li><a href="https://github.com/maxgfr/github-multi-deployments" target="_blank" rel="noreferrer">maxgfr/github-multi-deployments</a></li></ul><h2 id="functions" tabindex="-1">Functions <a class="header-anchor" href="#functions" aria-label="Permalink to &quot;Functions&quot;">‚Äã</a></h2><table><thead><tr><th>Function</th><th>Description</th></tr></thead><tbody><tr><td><p><a href="./functions/loadInputs.html">loadInputs</a></p></td><td><p>‚Äê</p></td></tr><tr><td><p><a href="./functions/parseEnvironments.html">parseEnvironments</a></p></td><td><p>‚Äê</p></td></tr><tr><td><p><a href="./functions/run.html">run</a></p></td><td><p>‚Äê</p></td></tr></tbody></table>`,24)]))}const g=i(e,[["render",l]]);export{E as __pageData,g as default};
